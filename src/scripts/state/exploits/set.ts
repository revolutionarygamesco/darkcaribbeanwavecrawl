import CrawlState, { Exploit } from '../state.ts'
import getCopy from '../get-copy.ts'
import saveCrawlState from '../save.ts'

const setExploits = async (
  captain: string,
  exploits: Exploit[],
  state?: CrawlState,
  save: boolean = true
): Promise<CrawlState> => {
  const copy = await getCopy(state)
  copy.exploits[captain] = exploits

  if (!save) return copy
  const stack = await saveCrawlState(copy)
  return stack[stack.length - 1]
}

export default setExploits
