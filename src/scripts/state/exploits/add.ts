import CrawlState, { Exploit } from '../state.ts'
import getCopy from '../get-copy.ts'
import saveCrawlState from '../save.ts'

const addExploit = async (
  captain: string,
  exploit: Exploit,
  state?: CrawlState,
  save: boolean = true
): Promise<CrawlState> => {
  const copy = await getCopy(state)
  if (!(captain in copy.exploits)) copy.exploits[captain] = []
  copy.exploits[captain].push(exploit)

  if (!save) return copy
  const stack = await saveCrawlState(copy)
  return stack[stack.length - 1]
}

export default addExploit
