import CrawlState from '../state.ts'
import getCopy from '../get-copy.ts'
import saveCrawlState from '../save.ts'
import setCrawlState from '../set.ts'

const twistExploit = async (
  captain: string,
  index: number,
  twist: string,
  state?: CrawlState,
  save: boolean = true
): Promise<CrawlState | null> => {
  const copy = await getCopy(state)
  if (!(captain in copy.exploits)) return null
  if (index >= copy.exploits[captain].length) return null
  copy.exploits[captain][index].legend.push(twist)

  if (!save) return copy
  await saveCrawlState(copy)
  return setCrawlState(copy)
}

export default twistExploit
